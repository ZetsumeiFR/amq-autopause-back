services:
  # Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: amq-autopause-app
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:3000"
    environment:
      # Database (external PostgreSQL on coolify network)
      DATABASE_URL: ${DATABASE_URL}

      # Server
      PORT: 3000

      # Better Auth
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
      BETTER_AUTH_URL: ${BETTER_AUTH_URL:-http://localhost:3000}

      # Twitch OAuth
      TWITCH_CLIENT_ID: ${TWITCH_CLIENT_ID}
      TWITCH_CLIENT_SECRET: ${TWITCH_CLIENT_SECRET}

      # Twitch EventSub
      TWITCH_EVENTSUB_SECRET: ${TWITCH_EVENTSUB_SECRET}
      WEBHOOK_CALLBACK_URL: ${WEBHOOK_CALLBACK_URL}

      # Optional settings
      SYNC_ON_STARTUP: ${SYNC_ON_STARTUP:-false}
    networks:
      - coolify
    volumes:
      # Mount drizzle migrations if needed
      - ./drizzle:/app/drizzle:ro

networks:
  coolify:
    external: true
